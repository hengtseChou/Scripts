#!/bin/bash
pycache_dirs=$(fd -H --type d "__pycache__" --exclude="*pyenv*" --exclude="*pipx*" --exclude="*Trash*")
python_history_files=$(fd -H --type f "python_history" --exclude="*Trash*")

if [ -z "$pycache_dirs" ] && [ -z "$python_history_files" ]; then
  echo "No __pycache__ directories or .python_history files found."
  exit 0
fi

if [ -n "$pycache_dirs" ]; then
  echo "The following __pycache__ directories were found:"
  echo "$pycache_dirs" | tr ' ' '\n'
else
  echo "No __pycache__ directories found."
fi

if [ -n "$python_history_files" ]; then
  echo "The following .python_history files were found:"
  echo "$python_history_files" | tr ' ' '\n'
else
  echo "No .python_history files found."
fi

read -p "Do you want to delete all of these directories and files? (yes/no) [yes]: " confirm
confirm=${confirm:-yes}

if [ "$confirm" == "yes" ]; then
  if [ -n "$pycache_dirs" ]; then
    echo "$pycache_dirs" | while read -r dir; do
      if trash "$dir"; then
        echo "Deleted: $dir"
      else
        echo "Failed to delete: $dir"
      fi
    done
  fi

  if [ -n "$python_history_files" ]; then
    echo "$python_history_files" | while read -r file; do
      if trash "$file"; then
        echo "Deleted: $file"
      else
        echo "Failed to delete: $file"
      fi
    done
  fi
else
  echo "Deletion aborted."
fi

